global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'otel-collector'
    static_configs:
      - targets: ['otel-collector:8889']

  - job_name: 'layer-1-ingestion'
    static_configs:
      - targets: ['ingestion:9101']

  - job_name: 'layer-2-processing'
    static_configs:
      - targets: ['processing:3002']

  - job_name: 'layer-4-analysis'
    static_configs:
      - targets: ['analysis:8081']

  - job_name: 'layer-5-aggregation'
    scrape_interval: 5s
    static_configs:
      - targets: ['aggregation:8080']

  - job_name: 'layer-6-signal'
    static_configs:
      - targets: ['signal:8082']

  - job_name: 'layer-7-api'
    scrape_interval: 5s
    static_configs:
      - targets: ['backend-api:4000']

  - job_name: 'telegram-bot'
    static_configs:
      - targets: ['telegram-bot:7000']

  - job_name: 'email-service'
    static_configs:
      - targets: ['email-service:7001']

  - job_name: 'ai-inference'
    static_configs:
      - targets: ['ai-inference:8000']

  - job_name: 'ollama'
    static_configs:
      - targets: ['ollama:11434']

  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
    metric_relabel_configs:
      # Extract a short readable ID
      - source_labels: [id]
        regex: '/docker/([a-f0-9]{12}).*'
        target_label: container_id
        replacement: '${1}'
      # Create 'container' label from name for consistency with Loki
      - source_labels: [name]
        target_label: container
      # Only keep Docker container metrics
      - source_labels: [id]
        regex: '/docker/.+'
        action: keep

  - job_name: 'redis-exporter'
    static_configs:
      - targets: ['redis-exporter:9121']

  - job_name: 'postgres-exporter'
    static_configs:
      - targets: ['postgres-exporter:9187']

  - job_name: 'pushgateway'
    honor_labels: true
    static_configs:
      - targets: ['prometheus-pushgateway:9091']
    scrape_interval: 5s
